package tqs.assignment.airquality.controller;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.internal.verification.VerificationModeFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.test.web.servlet.MockMvc;
import org.springframework.web.client.RestTemplate;

import java.net.URL;

import static org.hamcrest.CoreMatchers.is;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;


@SpringBootTest
@AutoConfigureMockMvc
public class ApiRestControllerTest {

    @Autowired
    private MockMvc mvc;

    @Mock
    private RestTemplate restTemplate;

    private String location = "Aveiro";

    @Test
    @Disabled
    public void whenGetCurrentDateOfLocation_thenReturnAirQuality() throws Exception {
        String mock_response = "{ \"location\": { \"address\": \"Aveiro\", \"coordinates\": { \"latitude\": 40.635013, \"longitude\": -8.651136 } }, \"pollutants\": { \"Carbon monoxide\": { \"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"value\": 276.92, \"units\": \"ppb\" }, \"Fine particulate matter (<2.5Âµm)\": { \"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (&lt;2.5Âµm)\", \"value\": 3.06, \"units\": \"ug/m3\" }, \"Inhalable particulate matter (<10Âµm)\": { \"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (&lt;10Âµm)\", \"value\": 8, \"units\": \"ug/m3\" }, \"Nitrogen dioxide\": { \"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"value\": 0.82, \"units\": \"ppb\" }, \"Ozone\": { \"display_name\": \"O3\", \"full_name\": \"Ozone\", \"value\": 24.31, \"units\": \"ppb\" }, \"Sulfur dioxide\": { \"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"value\": 0.86, \"units\": \"ppb\" } }, \"date\": null }";


        ObjectMapper mapper = new ObjectMapper();
        JsonNode root = mapper.readTree(mock_response);
        ResponseEntity<String> response = new ResponseEntity<>("{\"metadata\": null, \"data\": {\"datetime\": \"2021-05-14T22:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 276.92, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.82, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.31, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 8, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.06, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.86, \"units\": \"ppb\"}}}}, \"error\": null},[Content-Type:\"application/json\", Vary:\"Accept-Encoding\", Access-Control-Allow-Headers:\"Content-Type,Authorization\", Access-Control-Allow-Methods:\"GET,PUT,POST,DELETE\", Access-Control-Allow-Origin:\"*\", X-Appengine-Log-Flush-Count:\"1\", X-Cloud-Trace-Context:\"16b87ad8a7ee23d54a1acce3509dce0f\", Date:\"Fri, 14 May 2021 22:33:06 GMT\", Server:\"Google Frontend\", Content-Length:\"846\"]", HttpStatus.OK);

        URL url = new URL("http://localhost:8080/api/current/" + location);

        Mockito.when(restTemplate.getForEntity(url.toString(), String.class)).thenReturn(response);

        mvc.perform(get("/api/current/" + location)
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(jsonPath("location.coordinates.latitude", is(root.path("location").path("coordinates").get("latitude").asDouble())))
                .andExpect(jsonPath("location.coordinates.longitude", is(root.path("location").path("coordinates").get("longitude").asDouble())));

        Mockito.verify(restTemplate, VerificationModeFactory.times(1)).getForEntity(url.toString(), String.class);

    }

    @Test
    @Disabled
    public void whenGetForecasteOfLocation_thenReturnAirQualityList() throws Exception {
        String mock_response = "[ { \"location\": { \"address\": \"Aveiro\", \"coordinates\": { \"latitude\": 40.635013, \"longitude\": -8.651136 } }, \"pollutants\": { \"Carbon monoxide\": { \"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"value\": 198.77, \"units\": \"ppb\" }, \"Fine particulate matter (<2.5Âµm)\": { \"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (&lt;2.5Âµm)\", \"value\": 5.4, \"units\": \"ug/m3\" }, \"Inhalable particulate matter (<10Âµm)\": { \"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (&lt;10Âµm)\", \"value\": 10.08, \"units\": \"ug/m3\" }, \"Nitrogen dioxide\": { \"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"value\": 2.92, \"units\": \"ppb\" }, \"Ozone\": { \"display_name\": \"O3\", \"full_name\": \"Ozone\", \"value\": 27.96, \"units\": \"ppb\" }, \"Sulfur dioxide\": { \"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"value\": 0.67, \"units\": \"ppb\" } }, \"date\": \"2021-05-14T23:00:00.000+00:00\" }, { \"location\": { \"address\": \"Aveiro\", \"coordinates\": { \"latitude\": 40.635013, \"longitude\": -8.651136 } }, \"pollutants\": { \"Carbon monoxide\": { \"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"value\": 83.61, \"units\": \"ppb\" }, \"Fine particulate matter (<2.5Âµm)\": { \"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (&lt;2.5Âµm)\", \"value\": 4.9, \"units\": \"ug/m3\" }, \"Inhalable particulate matter (<10Âµm)\": { \"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (&lt;10Âµm)\", \"value\": 9, \"units\": \"ug/m3\" }, \"Nitrogen dioxide\": { \"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"value\": 1.75, \"units\": \"ppb\" }, \"Ozone\": { \"display_name\": \"O3\", \"full_name\": \"Ozone\", \"value\": 22.11, \"units\": \"ppb\" }, \"Sulfur dioxide\": { \"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"value\": 0.26, \"units\": \"ppb\" } }, \"date\": \"2021-05-15T23:00:00.000+00:00\" }, { \"location\": { \"address\": \"Aveiro\", \"coordinates\": { \"latitude\": 40.635013, \"longitude\": -8.651136 } }, \"pollutants\": { \"Carbon monoxide\": { \"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"value\": 105.83, \"units\": \"ppb\" }, \"Fine particulate matter (<2.5Âµm)\": { \"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (&lt;2.5Âµm)\", \"value\": 6.34, \"units\": \"ug/m3\" }, \"Inhalable particulate matter (<10Âµm)\": { \"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (&lt;10Âµm)\", \"value\": 17.39, \"units\": \"ug/m3\" }, \"Nitrogen dioxide\": { \"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"value\": 2.43, \"units\": \"ppb\" }, \"Ozone\": { \"display_name\": \"O3\", \"full_name\": \"Ozone\", \"value\": 39.11, \"units\": \"ppb\" }, \"Sulfur dioxide\": { \"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"value\": 0.51, \"units\": \"ppb\" } }, \"date\": \"2021-05-16T23:00:00.000+00:00\" } ]";

        ObjectMapper mapper = new ObjectMapper();
        JsonNode root = mapper.readTree(mock_response);

        ResponseEntity<String> response = new ResponseEntity<>("{\"metadata\": null, \"data\": [{\"datetime\": \"2021-05-15T00:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 198.77, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.92, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 27.96, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.08, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.4, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.67, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T01:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 169.18, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.87, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 28.05, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.18, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 6.3, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.57, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T02:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 153.71, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.86, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 27.1, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.97, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 6.1, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.48, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T03:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 142.47, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.74, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 25.47, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.28, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 6.55, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.48, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T04:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 134.96, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.73, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.49, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.61, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 6.62, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.46, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T05:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 106.36, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 3.21, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.02, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.75, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 7.63, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.39, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T06:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 107.22, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 3.56, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.1, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.16, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 6.93, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.29, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T07:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 104.69, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.69, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 26.17, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.71, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 7.45, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.28, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T08:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 102.25, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.95, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 28.33, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.56, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.74, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.39, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T09:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 97.5, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.62, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 33.05, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.87, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.89, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.35, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T10:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 96.45, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.97, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 35.96, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.38, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.62, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.27, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T11:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 95.54, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.85, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 35.43, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.56, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.31, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.23, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T12:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 94.72, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.7, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 34.9, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.23, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.17, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T13:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 91.5, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.65, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 34.01, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.59, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.73, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.24, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T14:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 91.38, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.62, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 33.31, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.88, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.85, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T15:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 89.45, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.57, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 32.59, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.92, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.71, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T16:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 87.64, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.67, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 31.48, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.92, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.04, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.28, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T17:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 87.31, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.81, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 30.7, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.83, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.92, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T18:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 85.64, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.88, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 29.7, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.56, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.67, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.22, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T19:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 85.55, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.29, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 28.74, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.48, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.31, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.24, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T20:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 87.03, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.46, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 27.63, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.93, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.22, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.32, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T21:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 87.06, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.61, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 26.23, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.79, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.92, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.38, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T22:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 85.97, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.88, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.43, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.23, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.3, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.36, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-15T23:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 84.63, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.0, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 23.2, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.4, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.95, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.28, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T00:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 83.61, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.75, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 22.11, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 9.0, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.9, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T01:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 82.61, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.6, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 20.85, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 8.64, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.03, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.25, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T02:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 80.2, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.56, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 19.63, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 8.31, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.2, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.25, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T03:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 81.55, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.51, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 19.15, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 8.2, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.26, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T04:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 81.33, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.63, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 19.41, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.97, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.98, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.28, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T05:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 81.05, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.66, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 19.26, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.9, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.39, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.33, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T06:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 81.78, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.79, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 18.9, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.5, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.16, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.37, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T07:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 81.66, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.79, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 19.08, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.31, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.99, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.33, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T08:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 80.19, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.39, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 21.49, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.61, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.53, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.2, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T09:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 79.19, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.05, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 22.91, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 5.94, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.75, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.19, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T10:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 77.84, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.86, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 23.28, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.13, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.68, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.17, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T11:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 77.69, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.74, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.26, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.28, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.63, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.22, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T12:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 77.47, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.65, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 24.97, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.3, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.55, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.25, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T13:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 77.77, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.69, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 25.61, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.98, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.69, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.25, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T14:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 77.69, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.73, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 26.26, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.19, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.79, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.28, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T15:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 78.02, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 0.83, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 26.88, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.08, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.75, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.3, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T16:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 78.77, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.13, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 25.82, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.61, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 3.69, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.25, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T17:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 79.98, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.26, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 26.92, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.64, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.08, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.29, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T18:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 88.85, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.06, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 33.64, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 8.03, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.41, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.24, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T19:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 102.86, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.04, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 44.05, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 6.32, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.34, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.27, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T20:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 106.27, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.19, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 46.4, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 7.62, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 4.72, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.27, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T21:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 106.53, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.47, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 45.82, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 11.19, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.15, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.26, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T22:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 106.18, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.52, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 43.65, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 10.97, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.06, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.34, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-16T23:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 105.49, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 1.62, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 41.05, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 13.32, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 5.44, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.38, \"units\": \"ppb\"}}}}, {\"datetime\": \"2021-05-17T00:00:00Z\", \"data_available\": true, \"pollutants\": {\"co\": {\"display_name\": \"CO\", \"full_name\": \"Carbon monoxide\", \"concentration\": {\"value\": 105.83, \"units\": \"ppb\"}}, \"no2\": {\"display_name\": \"NO2\", \"full_name\": \"Nitrogen dioxide\", \"concentration\": {\"value\": 2.43, \"units\": \"ppb\"}}, \"o3\": {\"display_name\": \"O3\", \"full_name\": \"Ozone\", \"concentration\": {\"value\": 39.11, \"units\": \"ppb\"}}, \"pm10\": {\"display_name\": \"PM10\", \"full_name\": \"Inhalable particulate matter (<10\\u00b5m)\", \"concentration\": {\"value\": 17.39, \"units\": \"ug/m3\"}}, \"pm25\": {\"display_name\": \"PM2.5\", \"full_name\": \"Fine particulate matter (<2.5\\u00b5m)\", \"concentration\": {\"value\": 6.34, \"units\": \"ug/m3\"}}, \"so2\": {\"display_name\": \"SO2\", \"full_name\": \"Sulfur dioxide\", \"concentration\": {\"value\": 0.51, \"units\": \"ppb\"}}}}], \"error\": null},[Content-Type:\"application/json\", Vary:\"Accept-Encoding\", Access-Control-Allow-Headers:\"Content-Type,Authorization\", Access-Control-Allow-Methods:\"GET,PUT,POST,DELETE\", Access-Control-Allow-Origin:\"*\", X-Appengine-Log-Flush-Count:\"1\", X-Cloud-Trace-Context:\"dab1e79b22c0bcb7d526c7497162567f\", Date:\"Fri, 14 May 2021 22:34:34 GMT\", Server:\"Google Frontend\", Content-Length:\"39584\"]", HttpStatus.OK);

        URL url = new URL("http://localhost:8080/api/forecast/" + location);

        Mockito.when(restTemplate.getForEntity(url.toString(), String.class)).thenReturn(response);


        mvc.perform(get("/api/forecast/" + location)
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(jsonPath("[0].location.coordinates.latitude", is(root.get(0).path("location").path("coordinates").get("latitude").asDouble())))
                .andExpect(jsonPath("[0].location.coordinates.longitude", is(root.get(0).path("location").path("coordinates").get("longitude").asDouble())))
                .andExpect(jsonPath("[1].location.coordinates.latitude", is(root.get(1).path("location").path("coordinates").get("latitude").asDouble())))
                .andExpect(jsonPath("[1].location.coordinates.longitude", is(root.get(1).path("location").path("coordinates").get("longitude").asDouble())))
                .andExpect(jsonPath("[2].location.coordinates.latitude", is(root.get(2).path("location").path("coordinates").get("latitude").asDouble())))
                .andExpect(jsonPath("[2].location.coordinates.longitude", is(root.get(2).path("location").path("coordinates").get("longitude").asDouble())));


        Mockito.verify(restTemplate, VerificationModeFactory.times(1)).getForEntity(url.toString(), String.class);

    }

    @Test
    public void whenGetCurrentCache_thenReturnAirQuality() throws Exception {
        String mock_response = "{ \"hits\": 0, \"misses\": 0, \"request_count\": 0, \"cached_requests\": {}, \"cached_requests_time\": {} }";

        ObjectMapper mapper = new ObjectMapper();
        JsonNode root = mapper.readTree(mock_response);

        mvc.perform(get("/api/cache/current")
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(jsonPath("hits", is(root.path("hits").asInt())))
                .andExpect(jsonPath("misses", is(root.path("misses").asInt())))
                .andExpect(jsonPath("request_count", is(root.path("request_count").asInt())));
    }

    @Test
    public void whenGetForecastCache_thenReturnAirQuality() throws Exception {
        String mock_response = "";

        ObjectMapper mapper = new ObjectMapper();
        JsonNode root = mapper.readTree(mock_response);



        mvc.perform(get("/api/cache/forecast")
                .contentType(MediaType.APPLICATION_JSON))
                .andExpect(status().isOk())
                .andExpect(jsonPath("hits", is(root.path("hits").asInt())))
                .andExpect(jsonPath("misses", is(root.path("misses").asInt())))
                .andExpect(jsonPath("request_count", is(root.path("request_count").asInt())));
    }


}